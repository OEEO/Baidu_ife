<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kingdom</title>
</head>
<style type="text/css">
    *{
        margin: 0;
        padding: 0;
    }

    #login{
        width: 300px;
        margin: 10% auto auto auto;
        text-align: center;
    }

    #login .main{
        display: inline-block;
    }
    #login fieldset{
        padding: 50px 0;
    }
    #login .main p:nth-child(2){
        margin-top: 20px;
    }


    #login .wrong::after{
        content: " *";
        position: absolute;
        left: 0;
        color: red;
    }


</style>
<body>
    <form action="php/accounts.php" method="POST" id="login">
        <fieldset>
            <legend>登录</legend>
            <div class="main">
                <p>
                    <label for="username">帐号</label>
                    <input type="text" id="username" name="username">
                </p>
                <p>
                    <label for="password">密码</label>
                    <input type="password" id="password" name="password">
                </p>
                <input type="submit" value="登录" id="submit">
            </div>
        </fieldset>
    </form>

    <p id="result" style="text-align: center;"></p>

    <script src="./jquery-3.2.1.js"></script>
    <script type="text/javascript">
        $('#username').bind('change', function() {
            var re = /(1[0-9]{10})|(\w+@\w+\.\w+)/;
            var userName = $('#username').val().trim();
            if (!re.test(userName)) {
                $('#username').parent().addClass('wrong');
            } else {
                $('#username').parent().removeClass('wrong');
            }
        });

        $('#username').bind('change', function() {
            $.ajax({
                type:'GET',
                url: './php/accounts.php?username=' + $('#username').val().trim(),
                dataType:'json',
                success:function(data) {
                    console.log(data);
                    if (data.success) {
                        $('#result').html(data.msg);
                    } else {
                        $('#result').html(data.msg);
                    }
                },
                error:function(jqXHR) {
                    console.log(jqXHR);
                    alert('出现错误啊：' + jqXHR.status);
                }
            });
        });
    </script>
</body>
</html>